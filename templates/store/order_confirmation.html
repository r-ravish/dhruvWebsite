{% extends 'base.html' %}
{% load static %}

{% block title %}Order Confirmation - ShopVerse{% endblock %}

{% block content %}
<section class="confirmation-section">
    <div class="container">
        <!-- Progress Steps -->
        <div class="checkout-steps">
            <div class="step completed">
                <span class="step-number">‚úì</span>
                <span class="step-text">Address</span>
            </div>
            <div class="step-line completed"></div>
            <div class="step completed">
                <span class="step-number">‚úì</span>
                <span class="step-text">Payment</span>
            </div>
            <div class="step-line completed"></div>
            <div class="step completed">
                <span class="step-number">‚úì</span>
                <span class="step-text">Confirmation</span>
            </div>
        </div>

        <div class="confirmation-box">
            <div class="success-icon">‚úì</div>
            <h1>Order Placed Successfully!</h1>
            <p class="order-number">Order #{{ order.id }}</p>
            
            <!-- Payment Status Banner -->
            {% if order.payment_method == 'cod' %}
                <div class="payment-banner cod-banner">
                    <span class="banner-icon">üíµ</span>
                    <div class="banner-content">
                        <strong>Cash on Delivery</strong>
                        <p>Pay ‚Çπ{{ order.get_total }} when your order arrives</p>
                    </div>
                </div>
            {% elif order.payment_status == 'awaiting_verification' %}
                <div class="payment-banner pending-banner">
                    <span class="banner-icon">‚è≥</span>
                    <div class="banner-content">
                        <strong>Payment Verification Pending</strong>
                        <p>Transaction ID: {{ order.transaction_id }}</p>
                        <p class="small">We'll verify your payment within 5-10 minutes</p>
                    </div>
                </div>
            {% elif order.payment_status == 'verified' %}
                <div class="payment-banner success-banner">
                    <span class="banner-icon">‚úì</span>
                    <div class="banner-content">
                        <strong>Payment Verified</strong>
                        <p>Transaction ID: {{ order.transaction_id }}</p>
                    </div>
                </div>
            {% endif %}
            
            <div class="confirmation-layout">
                <div class="order-details">
                    <h2>Delivery Address</h2>
                    <div class="address-card">
                        <p class="name">{{ order.full_name }}</p>
                        <p>{{ order.address }}</p>
                        <p>{{ order.city }}, {{ order.postal_code }}</p>
                        <p>{{ order.country }}</p>
                        <p class="contact"><strong>Phone:</strong> {{ order.phone }}</p>
                        <p class="contact"><strong>Email:</strong> {{ order.email }}</p>
                    </div>
                    
                    <div class="order-info">
                        <div class="info-row">
                            <span>Order Status:</span>
                            <span class="status-badge status-{{ order.status }}">{{ order.get_status_display }}</span>
                        </div>
                        <div class="info-row">
                            <span>Payment Method:</span>
                            <span>{{ order.get_payment_method_display }}</span>
                        </div>
                        <div class="info-row">
                            <span>Order Date:</span>
                            <span>{{ order.created_at|date:"F d, Y - h:i A" }}</span>
                        </div>
                    </div>
                </div>

                <div class="order-items">
                    <h2>Items Ordered</h2>
                    {% for item in order.items.all %}
                        <div class="order-item">
                            <div class="item-image">
                                {% if item.product.image %}
                                    <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                                {% else %}
                                    <div class="no-image">üì¶</div>
                                {% endif %}
                            </div>
                            <div class="item-details">
                                <span class="item-name">{{ item.product.name }}</span>
                                <span class="item-qty">Qty: {{ item.quantity }}</span>
                            </div>
                            <span class="item-price">‚Çπ{{ item.get_subtotal }}</span>
                        </div>
                    {% endfor %}
                    <div class="order-total">
                        <span>Total Amount</span>
                        <span>‚Çπ{{ order.get_total }}</span>
                    </div>
                </div>
            </div>

            <div class="confirmation-actions">
                <a href="{% url 'my_orders' %}" class="btn btn-primary">Track My Order</a>
                <a href="{% url 'product_list' %}" class="btn btn-outline">Continue Shopping</a>
            </div>
            
            <div class="order-help">
                <p>Need help with your order? <a href="#">Contact Support</a></p>
            </div>
        </div>
    </div>
</section>

<style>
.confirmation-section {
    padding: 30px 0;
    background: #f5f5f6;
    min-height: calc(100vh - 200px);
}

.checkout-steps {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 30px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.step-number {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: #666;
}

.step.completed .step-number {
    background: #14958f;
    color: white;
}

.step-text {
    font-size: 13px;
    color: #666;
}

.step.completed .step-text {
    color: #282c3f;
    font-weight: 500;
}

.step-line {
    width: 60px;
    height: 2px;
    background: #e0e0e0;
    margin: 0 10px;
}

.step-line.completed {
    background: #14958f;
}

.confirmation-box {
    background: white;
    border-radius: 8px;
    padding: 40px;
    max-width: 900px;
    margin: 0 auto;
}

.success-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #14958f 0%, #0d7a6d 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    margin: 0 auto 20px;
}

.confirmation-box h1 {
    text-align: center;
    color: #282c3f;
    margin-bottom: 10px;
}

.order-number {
    text-align: center;
    color: #666;
    font-size: 18px;
    margin-bottom: 25px;
}

.payment-banner {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
}

.cod-banner {
    background: #fff8e6;
    border: 1px solid #f5a623;
}

.pending-banner {
    background: #fff5f0;
    border: 1px solid #ff8c00;
}

.success-banner {
    background: #e8f5e9;
    border: 1px solid #14958f;
}

.banner-icon {
    font-size: 32px;
}

.banner-content strong {
    display: block;
    color: #282c3f;
    margin-bottom: 4px;
}

.banner-content p {
    color: #666;
    margin: 0;
    font-size: 14px;
}

.banner-content .small {
    font-size: 12px;
    color: #94969f;
    margin-top: 4px;
}

.confirmation-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.order-details h2,
.order-items h2 {
    font-size: 16px;
    color: #282c3f;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.address-card {
    background: #f8f8f8;
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.address-card .name {
    font-weight: 600;
    color: #282c3f;
    margin-bottom: 10px;
}

.address-card p {
    color: #666;
    margin: 4px 0;
    font-size: 14px;
}

.address-card .contact {
    margin-top: 10px;
}

.order-info {
    background: #f8f8f8;
    padding: 15px;
    border-radius: 6px;
}

.info-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 14px;
    color: #666;
}

.status-badge {
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.status-pending, .status-payment_pending {
    background: #fff5f0;
    color: #ff8c00;
}

.status-confirmed {
    background: #e8f5e9;
    color: #14958f;
}

.status-shipped {
    background: #e3f2fd;
    color: #1976d2;
}

.status-completed {
    background: #e8f5e9;
    color: #2e7d32;
}

.order-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px 0;
    border-bottom: 1px solid #f0f0f0;
}

.item-image {
    width: 60px;
    height: 60px;
    border-radius: 6px;
    overflow: hidden;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.no-image {
    font-size: 28px;
}

.item-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.item-name {
    font-size: 14px;
    color: #282c3f;
    font-weight: 500;
}

.item-qty {
    font-size: 12px;
    color: #94969f;
}

.item-price {
    font-weight: 600;
    color: #282c3f;
}

.order-total {
    display: flex;
    justify-content: space-between;
    padding: 15px 0;
    font-size: 18px;
    font-weight: 600;
    color: #282c3f;
}

.confirmation-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-bottom: 20px;
}

.confirmation-actions .btn {
    padding: 14px 30px;
}

.order-help {
    text-align: center;
    color: #94969f;
    font-size: 14px;
}

.order-help a {
    color: #ff3f6c;
}

@media (max-width: 768px) {
    .confirmation-layout {
        grid-template-columns: 1fr;
    }
    
    .confirmation-box {
        padding: 25px;
    }
    
    .confirmation-actions {
        flex-direction: column;
    }
    
    .checkout-steps {
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .step-line {
        width: 30px;
    }
}
</style>
{% endblock %}
